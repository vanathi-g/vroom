<%- include('header') %>

<div class="px-4 py-5 my-5 bg-light" style="border-radius: 0.5em;">
    <!-- <img class="d-block mx-auto mb-4" src="images/maps.jpg" alt="" width="400" height="400" /> -->
    <h4 class="display-6 fw-bold">Welcome!</h4>
    <hr>
    <div id="requests">
        <table id="request" class="details-table">
            <tbody>
                <% requests.forEach( trip => { %>
                <tr>
                    <td><%= trip.trip_id %></td>
                    <td><%= trip.destAddress %></td>
                    <td><%= trip.destCity %></td>
                    <td><%= trip.destState %></td>
                    <td><%= trip.destZip %></td>
                    <td><%= trip.pickuptime %></td>
                    <td><button onclick='updateStatus(event, "confirmed")'>Accept</button></td>
                </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
    <div id="upcoming">
        <table id="upcoming" class="details-table">
            <tbody>
                <% upcoming.forEach( trip => { %>
                <tr>
                    <td><%= trip.trip_id %></td>
                    <td><%= trip.destAddress %></td>
                    <td><%= trip.destCity %></td>
                    <td><%= trip.destState %></td>
                    <td><%= trip.destZip %></td>
                    <td><%= trip.pickuptime %></td>
                    <% if (trip.status == "confirmed") { %>
                        <td><button onclick='updateStatus(event, "transit")'>Start</button></td>
                    <% } else { %>
                        <td><button onclick='updateStatus(event, "delivered")'>End</button></td>
                    <% } %>
                </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
    <form id="trip-form" method="post" action="/driver">
        <input id="trip-id" type="hidden" name="trip_id" value="">
        <input id="trip-status" type="hidden" name="trip_status" value="">
    </form>
</div>
</div>
<script>
    function updateStatus(event, status){
        let trip_id = event.target.parentNode.parentNode.firstChild.nextSibling.textContent;
        document.getElementById('trip-id').value = trip_id;
        document.getElementById('trip-status').value = status;
        document.getElementById('trip-form').submit();
    }
</script>

<% include('footer') %>